<script>
(function () {
  'use strict';

  /* --- Configuration --- */
  var FOOTER_ID  = 'ew-footer';
  var SHIMMER_ID = 'ew-shimmer';
  var MAX_WAIT   = 15000;
  var POLL_MS    = 150;

  /* --- Reduced motion check --- */
  var prefersReducedMotion = window.matchMedia
    ? window.matchMedia('(prefers-reduced-motion: reduce)').matches
    : false;

  /* --- State --- */
  var observer  = null;
  var pollTimer = null;
  var startTime = Date.now();
  var injected  = false;

  /* --- Entry point: MutationObserver primary, polling fallback --- */
  if (typeof MutationObserver !== 'undefined') {
    observer = new MutationObserver(function () {
      attemptInjection();
    });
    observer.observe(document.documentElement, {
      childList: true,
      subtree: true
    });
    attemptInjection();
  } else {
    pollTimer = setInterval(function () {
      attemptInjection();
      if (Date.now() - startTime > MAX_WAIT) {
        clearInterval(pollTimer);
      }
    }, POLL_MS);
  }

  setTimeout(function () { stopWatching(); }, MAX_WAIT);

  function attemptInjection() {
    if (injected) return;

    var loginBody = document.querySelector('.hl_login--body');
    if (!loginBody) return;

    try {
      injectFooter();
      initLoadingState();
      if (!prefersReducedMotion) {
        initCardShimmer();
      }
      associateLabels();
      injected = true;
      stopWatching();
    } catch (e) {
      if (typeof console !== 'undefined' && console.warn) {
        console.warn('[EW Login] Enhancement failed:', e);
      }
    }
  }

  /* --- Footer below the login card --- */
  function injectFooter() {
    if (document.getElementById(FOOTER_ID)) return;

    var loginBody = document.querySelector('.hl_login--body');
    if (!loginBody || !loginBody.parentNode) return;

    var footer = document.createElement('div');
    footer.id = FOOTER_ID;
    footer.style.cssText = [
      'text-align: center !important',
      'font-family: Gilroy, system-ui, -apple-system, sans-serif !important',
      'font-size: 11px !important',
      'color: rgba(255, 255, 255, 0.5) !important',
      'padding: 24px 0 !important',
      '-webkit-font-smoothing: antialiased !important'
    ].join('; ');

    var footerLine1 = document.createElement('div');
    footerLine1.textContent = '\u00A9 2026 Endless Winning';

    var footerLink = document.createElement('a');
    footerLink.href = 'https://endlesswinning.com';
    footerLink.target = '_blank';
    footerLink.rel = 'noopener';
    footerLink.textContent = 'endlesswinning.com';
    footerLink.style.cssText = [
      'color: rgba(255, 255, 255, 0.5) !important',
      'text-decoration: underline !important',
      'text-decoration-color: rgba(255, 255, 255, 0.2) !important',
      'text-underline-offset: 3px !important',
      'font-size: 11px !important',
      'display: inline-block !important',
      'margin-top: 4px !important'
    ].join('; ');

    footer.appendChild(footerLine1);
    footer.appendChild(footerLink);

    if (loginBody.nextSibling) {
      loginBody.parentNode.insertBefore(footer, loginBody.nextSibling);
    } else {
      loginBody.parentNode.appendChild(footer);
    }
  }

  /* --- Loading State: spinner on submit --- */
  function initLoadingState() {
    var form = document.querySelector('.hl_login--body form');
    var btn = document.querySelector('.hl_login .btn.btn-blue');
    if (!form || !btn) return;

    /* Wrap button text in span for fade control */
    var children = btn.childNodes;
    for (var i = 0; i < children.length; i++) {
      var node = children[i];
      if (node.nodeType === 3 && node.textContent.trim()) {
        var span = document.createElement('span');
        span.className = 'ew-btn-text';
        span.textContent = node.textContent;
        btn.replaceChild(span, node);
        break;
      }
    }

    if (!btn.querySelector('.ew-btn-text')) {
      var existingText = btn.querySelector('span, strong, b');
      if (existingText) existingText.classList.add('ew-btn-text');
    }

    form.addEventListener('submit', function () {
      btn.classList.add('ew-loading');
      setTimeout(function () {
        btn.classList.remove('ew-loading');
      }, 8000);
    });
  }

  /* --- Card Glass Shimmer (mouse-tracked) --- */
  function initCardShimmer() {
    if (document.getElementById(SHIMMER_ID)) return;

    var card = document.querySelector('div.hl_login--body');
    if (!card) return;

    var shimmer = document.createElement('div');
    shimmer.id = SHIMMER_ID;
    shimmer.style.cssText = [
      'position: absolute',
      'inset: 0',
      'border-radius: 24px',
      'pointer-events: none',
      'z-index: 2',
      'opacity: 0',
      'transition: opacity 0.4s ease',
      'background: radial-gradient(300px circle at 50% 50%, rgba(139, 241, 241, 0.04), transparent 60%)'
    ].join('; ');

    card.appendChild(shimmer);

    card.addEventListener('mouseenter', function () {
      shimmer.style.opacity = '1';
    });

    card.addEventListener('mouseleave', function () {
      shimmer.style.opacity = '0';
    });

    card.addEventListener('mousemove', function (e) {
      var rect = card.getBoundingClientRect();
      var x = e.clientX - rect.left;
      var y = e.clientY - rect.top;
      shimmer.style.background =
        'radial-gradient(300px circle at ' + x + 'px ' + y + 'px, rgba(139, 241, 241, 0.04), transparent 60%)';
    });
  }

  /* --- Associate Labels with Inputs (a11y) --- */
  function associateLabels() {
    var labels = document.querySelectorAll('.hl_login--body label');
    for (var i = 0; i < labels.length; i++) {
      var label = labels[i];
      if (label.getAttribute('for')) continue;
      var parent = label.parentElement;
      var input = parent ? (parent.querySelector('input') ||
        (label.nextElementSibling && label.nextElementSibling.querySelector
          ? label.nextElementSibling.querySelector('input') : null)) : null;
      if (input && !input.id) {
        var inputId = 'ew-input-' + i;
        input.id = inputId;
        label.setAttribute('for', inputId);
      }
    }
  }

  function stopWatching() {
    if (observer) { observer.disconnect(); observer = null; }
    if (pollTimer) { clearInterval(pollTimer); pollTimer = null; }
  }
})();
</script>
